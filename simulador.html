<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador - Sección Perfil</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
  <style media="screen" type="text/css">
    .perfil {
        margin: 100px 0;
    }

    .full-bar {
        height: 5px;
        background-color: #D2F1FD;
        border-radius: 7px;
        width: 100%;
    }

    .parcial-bar {
        height: 5px;
        background-color: #0061A0;
        border-radius: 7px;
        margin-top: -5px;
        margin-bottom: 5px;
        transition: width .3s ease;

    }

    .green-text {
        color: #DCF94D;
        font-size: 16px;
        font-family: var(--typography-font-default);
        border: 1px solid #DCF94D;
        border-radius: 16px;
        position: relative;
        padding-left: 20px;
        padding-right: 5px;
        margin-left: 10px;
        position: relative;
        top: -3px;
    }

    .green-text:before {
        content: "";
        display: block;
        width: 20px;
        height: 20px;
        background-image: url("https://principal.com.mx/sites/default/files/2023-09/arrow-up.svg");
        background-size: 20px;
        background-position: center;
        background-repeat: no-repeat;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);

    }

    .form-container {
        display: flex;
        flex-direction: column;
        max-width: 324px;
        width: 100%;
        padding: 35px 25px 56px 25px;
        border-radius: 15px;
        text-align: left;
        background: linear-gradient(136.44deg, #002855 12.86%, #004C97 100%);
        color: white;
        max-height: 615px;
    }

    .form-container h2 {
        font-weight: 700;
        font-size: 18px;
        line-height: 20px;
        color: rgb(51, 51, 51);
        margin-bottom: 24px;
    }

    .wrap .simulacion .perfil-container.text-container p {
        font-size: 16px;
        color: black;
    }

    .wrap .simulacion .perfil-container.text-container p.title-perfil {
        font-size: 26px;
        color: #002855;
        margin-bottom: 12px;
    }

    .font-bold-custom {
        font-family: var(--typography-font-secondary) !important;
    }

    .font-trans-upper {
        text-transform: uppercase;
    }

    .form-container .input-container .label p span {
        font-weight: bold;
    }

    .form-email.input-container.desktop {
        margin-top: 50px;
    }

    .form-col {
        flex-wrap: wrap;
    }

    /* Estilos para la barra de progreso */
    .barra-container {
        width: 100%;
        height: 5px;
        background-color: #ccc;
        position: relative;
        border-radius: 10px;
        /* Hace los extremos circulares */
        overflow: hidden;
        /* Oculta el contenido que se desborda */
    }

    .barra-llena {
        height: 100%;
        width: 0;
        background-color: #4CAF50;
        position: absolute;
        border-radius: 10px;
        /* Hace los extremos circulares */
    }

    .barra-vacia {
        height: 100%;
        width: 100%;
        background-color: #D2F1FD;
        position: absolute;
        border-radius: 10px;
        /* Hace los extremos circulares */
    }

    .form-email.input-container.desktop input {
        height: 50px;
    }

    .form-email.input-container.desktop button {
        margin-top: 10px;
        padding: 0px 30px;
        background-color: #006699;
        border: none;
        border-radius: 100px;
        font-size: 16px;
        line-height: 20px;
        color: #fff;
        padding: 8px 0;
        width: 90%;
    }

    .form-email.input-container.desktop button:disabled {
        background-color: #F6F6F8;
        color: #9D9EA4;
    }

    .container-amounts .amount-container {
        border-radius: 5px;
    }

    .container-amounts .amount-container:nth-of-type(1) {
        background: linear-gradient(136.44deg, #002855 12.86%, #004C97 100%);
    }

    .container-amounts .amount-container:nth-of-type(1) p {
        color: #55FFF5;
        max-width: inherit;

    }

    .container-amounts .amount-container:nth-of-type(1) p.money {
        font-size: 28px;
        line-height: 31px;
    }


    .input-container {
        margin-bottom: 24px;
        position: relative;
    }

    .input-container .label {
        margin-bottom: 10px;
        display: flex;
        position: relative;
        flex-wrap: wrap;
    }

    .input-container.input-title {
        margin-bottom: 0;
        margin-top: 5px;
    }

    .input-container .label p {
        margin-bottom: 0;
        margin-right: 5px;
        line-height: 18px;
        font-size: 14px;
    }

    .input-container .label p span {
        font-size: 16px;
    }

    .input-container .label .help-icon {
        position: relative;
        bottom: 5px;
    }

    .input-container .help-icon .help-msg {
        position: absolute;
        background-color: #444040;
        color: #fff;
        font-size: 10px;
        right: -70px;
        top: -20px;
        padding: 10px;
        border-radius: 25px 25px 25px 0;
        display: none;
        justify-content: center;
        transform: translate(50%, -50%);
        z-index: 2;

    }

    .input-container .help-icon .help-msg p {
        color: #fff;
        font-size: 10px;
    }

    .input-container .help-icon:hover .help-msg {
        display: flex;
    }

    .input-container .help-msg p {
        margin: auto;
        width: 120px;
    }

    .input-container input {
        width: 100%;
        font-size: 14px;
        height: 50px;
        border-radius: 4px;
        box-shadow: none;
        border: 1px solid #000;
        padding: 0 15px;
    }

    .status-msg {
        display: none;
        color: rgb(255, 0, 0);
    }

    .input-container .status {
        display: none;
        width: 20px;
        position: absolute;
        right: 10px;
        top: 80px;
    }

    .form-email.desktop {
        padding: 0 25px;
    }

    .form-email.desktop p {
        color: #004C97;
        max-width: 220px;
        font-family: "fs_elliot_proregular"
    }

    .form-email.desktop p span {
        font-family: "fs_elliot_probold"
    }

    .input-container:nth-of-type(2) .status {
        top: 78px;
    }

    .status-ok {
        color: rgb(0, 145, 218);
    }

    .status-not-ok {
        color: red;
    }

    .tipo-de-perfil {
        width: 181px;
        height: 40px;
        background: rgb(0, 72, 135);
        border-radius: 40px;
        color: rgb(255, 255, 255);
        font-weight: 400;
        font-size: 16px;
        line-height: 18px;
        text-align: center;
        box-shadow: none;
        border: medium none;
        transition: background-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0s;
        margin-bottom: 15px;
    }

    .tipo-de-perfil.disabled {
        width: 181px;
        height: 40px;
        background: rgb(232, 232, 232);
        border-radius: 40px;
        color: rgb(97, 98, 103);
        font-style: normal;
        font-weight: 400;
        font-size: 16px;
        line-height: 18px;
        text-align: center;
        box-shadow: none;
        border: none;
        transition: background-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0s;
    }

    .step-progress-bar {
        align-items: center;
        display: flex;
        height: 30px;
        justify-content: center;
        width: 100%;
    }

    .RSPBprogressBar {
        align-items: center;
        background-color: hsla(0, 0%, 83%, .6);
        border-radius: 10px;
        display: flex;
        height: 10px;
        justify-content: space-between;
        line-height: 1;
        position: relative;
        z-index: 0;
    }

    .RSPBprogressBar .RSPBprogression {
        background: rgba(0, 116, 217, .8);
        border-radius: 10px;
        bottom: 0;
        left: 0;
        position: absolute;
        top: 0;
        transition: width .3s ease;
        z-index: -1;
    }

    .RSPBprogressBar .RSPBstep {
        align-items: center;
        display: inline-flex;
        justify-content: center;
        position: absolute;
        -webkit-transform: translateX(-50%);
        transform: translateX(-50%);
        transition-property: all;
        transition-timing-function: ease;
        z-index: 0;
    }

    .jss1 {
        margin: 0px 0px 10px 0px;
        display: flex;
        flex-direction: column;
    }

    .lbatDQ {
        display: flex;
        flex-direction: row;
    }

    .jss2 {
        width: 30%;
        height: 27px;
        background: #FFFFFF;
        margin-right: 10px;
        border-radius: 4px;
    }

    #LPF_Cambiar_Duracion_plazo {
        font-size: 14px;
        height: 50px;
        border-radius: 4px;
        box-shadow: none;
        border: 1px solid #000;
    }

    .MuiInput-underline::before {
        left: 0;
        right: 0;
        bottom: 0;
        content: "\00a0";
        position: absolute;
        transition: border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
        border-bottom: 1px solid white;
        pointer-events: none;
    }

    #activoslistado {
        font-size: 14px;
    }

    input[type="number"] {
        color: #464646;
        font-family: "fs_elliot_proregular", 'FontAwesome', "Arial", arial, sans-serif;
        border: 1px solid #e6e6e6;
        font-size: 14px;
        box-shadow: none;
        display: block;
        width: 100%;
        padding-left: 12px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    .MuiInput-underline::after {
        left: 0;
        right: 0;
        bottom: 0;
        content: "";
        position: absolute;
        transform: scaleX(0);
        transition: transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;
        border-bottom: 2px solid #3f51b5;
        pointer-events: none;
    }

    .bJqQyw {
        box-sizing: border-box;
        width: 70%;
        height: 26.95px;
        background: rgb(255, 255, 255);
        border: 1px solid rgb(51, 51, 51);
        border-radius: 4px;
        padding-right: 20px !important;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        font-size: 14px;
        height: 50px;
        border-radius: 4px;
        box-shadow: none;
        border: 1px solid #000;
        padding: 0 15px;
    }

    .MuiSlider-root {
        background: black;
        width: 100%;
        cursor: pointer;
        height: 2px;
        display: inline-block;
        padding: inherit;
        position: relative;
        box-sizing: content-box;
        touch-action: none;
        -webkit-tap-highlight-color: transparent;
    }

    .MuiSlider-rail {
        width: 100%;
        height: 2px;
        display: block;
        opacity: 0.38;
        position: absolute;
        border-radius: 1px;
        background-color: currentColor;
    }

    .MuiSlider-track {
        height: 2px;
        display: block;
        position: absolute;
        border-radius: 1px;
        background-color: currentColor;
    }

    .jss4 {
        height: 2.8px;
        background: #616267;
    }

    .jss5 {
        width: 50%;
        height: 2.8px;
        background: #00EFE8;
    }

    .MuiSlider-thumb {
        width: 12px;
        height: 12px;
        display: flex;
        outline: 0;
        position: absolute;
        box-sizing: border-box;
        margin-top: -5px;
        transition: box-shadow 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
        align-items: center;
        margin-left: -6px;
        border-radius: 50%;
        justify-content: center;
        background-color: currentColor;
        top: -2px;
        width: 21px;
        height: 20.96px;
        background: #00EFE8;
        box-shadow: none !important;
    }

    button:focus {
        outline: none;
    }

    .wrap {
        flex-wrap: wrap;
        padding: 0 0 75px 0;
    }

    .proyeccion {
        text-align: center;
        margin-bottom: 50px;
    }

    .proyeccion p {
        max-width: 500px;
        margin: 0 auto;
    }

    .amount-container {
        display: inline-block;
        background-color: #F5F5F5;
        padding: 5px 10px;
    }

    .amount-container .money {
        font-size: 18px;
        margin: 0;
    }

    .amount-container p:not(.money) {
        font-size: 14px;
        max-width: 100px;
        line-height: 1;
    }

    .torre.img-container {
        position: relative;
        margin: 0;
        margin-bottom: 230px;
        text-align: left;
    }

    .torre.img-container img {
        width: 300px;
    }

    .torre.img-container h3 {
        font-size: 18px;
        font-weight: 700;
    }

    .torre .amount-container {
        position: absolute;
        background-color: #ffff;
    }

    .torre .amount-container.first {
        top: 5%;
        left: 29%;
        text-align: left;
    }

    .torre .amount-container p {
        margin-top: 0;
        font-size: 16px;
        max-width: inherit;
        margin-bottom: 0;
    }

    .torre .amount-container.second {
        left: 29%;
        top: 35%;
        text-align: left;
    }

    .proyeccion button,
    .proyeccion a {
        text-decoration: none;
        display: block;
        color: white;
        border: 1px solid #006699;
        border-radius: 30px;
        padding: 10px 0;
        width: 250px;
        margin: 0 auto;
        background-color: #006699;
        margin-bottom: 15px;
        margin-top: 20px;
    }

    .proyeccion button:hover,
    .proyeccion a:hover {
        background-color: white;
        color: #006699;
    }

    .inversion {
        top: 250px;
        padding: 0 43px;
        position: absolute;
        right: 0;
    }

    .inversion h3 {
        font-size: 16px;
    }

    .inversion p {
        font-size: 14px;
        margin-bottom: 12px;
    }

    .activos {
        background-color: inherit;
        margin-bottom: 50px;
    }

    #activostitulo {
        display: none;
    }

    .activos ul {
        list-style: none;
        padding: unset;
        margin: 0;
    }

    .activos ul li {
        display: flex;
        text-transform: capitalize;
    }

    .activos ul li:before {
        /* content: ""; */
        width: 10px;
        height: 10px;
        position: relative;
        display: block;
        top: 7px;
        left: -5px;
    }

    .activos ul li:first-of-type:before {
        background-color: #43729c;
    }

    .activos ul li:nth-of-type(2):before {
        background-color: #4e85b6;
    }

    .activos ul li:nth-of-type(3):before {
        background-color: #5795cc;
    }

    .activos ul li:nth-of-type(4):before {
        background-color: #95bee4;
    }

    .activos ul li:nth-of-type(5):before {
        background-color: #bad5ed;
    }

    .activos ul li:nth-of-type(6):before {
        background-color: #d3e4f4;
    }

    .activos ul li:nth-of-type(7):before {
        background-color: #bad5ed;
    }

    .activos ul li:nth-of-type(8):before {
        background-color: #d0dbf0;
    }

    .activos ul li span {
        font-weight: 400;
        margin-left: auto;
    }

    .rueda {
        display: flex;
        align-items: center;

    }

    .rueda .img-container {
        width: 230px;
        height: auto;
        margin: auto auto;
    }

    .rueda .img-container img {
        width: 100%;
    }

    .box-border {
        max-width: 1040px;
        margin: 0 auto;
    }

    .simulacion {
        padding: 0;
    }

    .proyeccion {
        padding: 0;
    }

    .wrap .simulacion .text-container p {
        font-size: 24px;
        line-height: 31px;
    }

    .wrap .proyeccion small p {
        max-width: 425px;
        margin: auto;
        margin-bottom: 25px;
    }

    .radio-container label {
        margin-right: 65px;
    }

    .input-container.radio-container input.radio {
        width: 15px;
        height: 15px;
    }

    .rueda a {
        text-decoration: none;
        display: block;
        text-align: center;
        color: white;
        border: 1px solid #006699;
        border-radius: 30px;
        padding: 10px 0;
        width: 170px;
        margin: 0 auto;
        background-color: #006699;
        margin-bottom: 15px;
    }

    input[type="range"] {
        margin-right: 15px;
        width: 200px;
        height: 2px;
        background: #616267;
        border-radius: 5px;
        background-image: linear-gradient(#00EFE8, #00EFE8);
        background-size: 100%;
        background-repeat: no-repeat;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #00EFE8;
        cursor: ew-resize;
        box-shadow: 0 0 2px 0 #555;
        transition: background .3s ease-in-out;
    }

    input[type=range]::-webkit-slider-runnable-track {
        -webkit-appearance: none;
        box-shadow: none;
        border: none;
        background: transparent;
    }

    .button-save-form {
        margin: 0 auto;
        width: 100px;
        text-align: center;
        border: 1px solid #002E6D;
        border-radius: 30px;
    }

    .button-save-form p {
        padding: 5px 10px;
        margin-bottom: 0;
        color: #002E6D;
    }


    @media (min-width: 481px) {
        .mobile {
            display: none;
        }
    }

    .loader {
        border: 16px solid #f3f3f3;
        /* Light grey */
        border-top: 16px solid #3498db;
        /* Blue */
        border-radius: 50%;
        width: 100px;
        height: 100px;
        animation: spin 2s linear infinite;
    }

    .loader_small {
        border: 16px solid #f3f3f3;
        /* Light grey */
        border-top: 16px solid #3498db;
        /* Blue */
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 2s linear infinite;
    }

    .centered {
        margin: 0 auto;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .desktop {
        display: flex;
    }

    .mobile {
        display: none !important;
    }

    .container-amounts {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 36px;
    }

    .container-amounts .amount-container {
        border-radius: 5px;
        width: calc(27% - 3.334px);
    }

    .container-amounts .amount-container:nth-of-type(1) {
        order: 2;
        width: calc(46% - 3.334px);
    }

    .container-amounts .amount-container:nth-of-type(2) {
        order: 1;
    }

    .container-amounts .amount-container:nth-of-type(3) {
        order: 3;
    }

    @media (max-width: 699px) {
        .mobile {
            display: block !important;
        }

        .desktop {
            display: none !important;
        }

        .title-perfil {
            display: none;
        }

        .container-amounts {
            gap: 2px;
        }

        .container-amounts .amount-container:nth-of-type(1) {
            width: 100%;
            margin: 0;
            order: 1;
            margin-bottom: 15px;
            background-color: inherit;
            max-width: 100%;
        }

        .container-amounts .amount-container:nth-of-type(1) .money {
            font-size: 28px;
            font-weight: 700;
        }

        .container-amounts .amount-container:nth-of-type(2),
        .container-amounts .amount-container:nth-of-type(3) {
            width: calc(50% - 1px);
            order: 2;
            padding: 10px 20px;
        }

        .container-amounts .amount-container:nth-of-type(2) p,
        .container-amounts .amount-container:nth-of-type(3) p {
            line-height: 15.4px;
        }

    }

    @media (max-width: 480px) {
        .form-container {
            min-width: 100%;
        }

        .small-label {
            display: none;
        }

        .simulacion {
            padding: 0 15px;

        }

        .proyeccion {
            padding: 0 15px;
        }

        .inversion {
            position: static;
            padding: 0 15px;
        }

        .small-text {
            display: none;
        }

        .proyeccion {
            margin-bottom: 30px;
        }

        .desktop {
            display: none;
        }

        .perfil {
            margin-bottom: 0;
        }

        .amount-container {
            max-width: 100%;
            margin-bottom: 25px;
        }

        .amount-container .money {
            font-size: 16px;
        }

        .torre .amount-container {
            background-color: unset;
        }

        .torre .amount-container.first {
            right: 0%;
        }

        .torre .amount-container.second {
            left: -7%;
        }

        .torre .amount-container.second p {
            text-align: left;
        }

        .rueda {
            flex-direction: column-reverse;
        }

        #myChart {
            display: none;
            margin: 30px 0;
        }

        .torre.img-container {
            margin: 0 0 50px;
            display: none;
        }

        .wrap .simulacion .text-container p {
            font-size: 16px;
            line-height: 22px;
        }

        .perfil {
            margin-top: 0;
        }

        .box-border {
            border-radius: inherit;
            border: inherit;
        }

        .container-amounts {
            margin-bottom: 70px;
            transition: all .3s ease;
        }

        .container-amounts.activated {
            margin-bottom: 470px;
        }

        .form-col {
            position: absolute;
            top: 410px;
            left: 0;
            z-index: 99;
            height: 75px;
            overflow: hidden;
            flex-direction: column;
            transition: height 0.3s ease;
            flex-wrap: nowrap;
        }

        .form-col.activated {
            height: 577px;
        }

        .input-container .status {
            top: 70px;
        }

        .input-container:nth-of-type(2) .status {
            top: 68px;
        }

        .form-container {
            background: transparent;
            color: inherit;
            border-radius: 0;
            padding: 10px 57px 56px 47px;
        }

        .form-container .input-container .label p {
            max-width: 100%;
            font-size: 14px;
            line-height: 15px;
        }

        .toggle-button {
            text-align: center;
            /* background-color:#002855;
      color: white; */
            padding-top: 10px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .toggle-button img {
            width: 12px;
        }

        .toggle-button p {
            margin-top: 10px;
        }

        .toggle-button p:first-of-type {
            padding-right: 15px;
            position: relative;
            text-align: right;
            color: #0f569d;
            cursor: pointer;
        }

        .toggle-button p:first-of-type:after {
            content: "";
            display: block;
            position: absolute;
            background-image: url("https://principal.com.mx/sites/default/files/2023-09/Component%20115.svg");
            background-position: center;
            background-repeat: no-repeat;
            background-size: 12px;
            width: 12px;
            height: 12px;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .activated .toggle-button img {
            transform: rotate(180deg);
        }

        .arrow {
            display: inline-block;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 5px 5px 5px;
            border-color: transparent transparent #555 transparent;
            transition: transform 0.3s ease-in-out;
            position: relative;
        }

        .arrow::before,
        .arrow::after {
            content: '';
            position: absolute;
            bottom: -5px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 5px 5px 5px;
            border-color: transparent transparent #555 transparent;
        }

        .arrow::before {
            left: -6px;
        }

        .arrow::after {
            left: 6px;
        }

        .flipped {
            transform: rotate(180deg);
        }

        .amount-container p {
            font-size: 14px;
        }

        .container-amounts .amount-container:nth-of-type(1) p.money {
            font-size: 28px;
            line-height: 31px;
        }

        .container-amounts .amount-container:nth-of-type(1) p {
            font-size: 14px;
            color: #55FFF5;
        }

        .input-container input {
            width: 100%;
        }

        .form-email.input-container.mobile {
            text-align: left;
        }

        .form-email.input-container.mobile p span {
            font-weight: bold;
            margin-bottom: 12px;
            color: #1A426F;
        }

        .form-email.input-container.mobile .label {
            display: inherit;
        }

        .form-email.input-container.mobile input {
            margin-bottom: 10px;
            width: 70%;
        }

        .form-email.input-container.mobile {
            margin-bottom: 0;
        }

        .form-email.input-container.mobile .form-area-email {
            margin-bottom: 0;
        }

        .form-email.input-container.mobile button {
            background-color: #006699;
            border: none;
            border-radius: 100px;
            font-family: 'fs_elliot_probold';
            font-style: normal;
            font-size: 16px;
            line-height: 28px;
            color: #fff;
            margin: inherit;
            margin-bottom: 0;
            width: 60%;
        }

        .form-email.input-container.mobile button:disabled {
            background-color: #F6F6F8;
            color: #9D9EA4;
        }

        .inversion h3 {
            margin-bottom: 10px;
        }
    }

    #risklevel {
        text-transform: capitalize;
    }
</style>
<style media="screen" type="text/css">.embeddedServiceHelpButton {
    display: none;
  }
  #whatsbtn {
    width: 216px!important;
  padding-left: 50px!important;
  background-position: initial!important;
  box-shadow: 2px 2px 4px 0px rgba(0, 0, 0, 0.5)!important;
  border-radius: 7px!important;
  background-color: #fff!important;
  }
  .fixed-whats{
  position: fixed;
  right: 15px;
  bottom: 15px;
  display: block;
  width: fit-content;
  z-index:99;
  }
  .fixed-whats img{
  width: 220px;
  height auto;
  }
  .footer{
      background-color: #f6f6f8;
      padding: 70px 0;
    }
    .footer .social-media {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .footer .social-media a {
      margin: 0 7px;
    }
    .footer .social-media a img{
      height: 24px;
      width: auto;
    }
    .footer .phone {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .footer .phone img{
      height: 17px;
      width: auto;
      margin-right: 10px;
    }
    .footer .links {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .footer .links .divisor{
      margin: 0 10px;
    }
    .footer .links a{
      color: rgb(97, 98, 103);
      text-decoration: underline;
      text-decoration-style: dotted;
      text-underline-position: under;
    }
    .footer .links a:hover{
      text-decoration: none;
    }
    .footer p {
      max-width: 820px;
      text-align: center;
      margin: auto;
    }
    .footer p.disclaimer {
      margin-top: 50px;
    }
  </style>
</head>
<body>
<section class="perfil ">
    <div class="container">
        <div class="d-md-flex box-border">
            <div class="col-md-4 p-0 d-flex form-col" id="form-col">
                <div class="toggle-button mobile" id="toggleButton">
                    <p>
                        Editar datos
                    </p>
                </div>
                <div class="form-container">
                    <p class="d-none">
                        <strong id="risklevel">Tradicional</strong>
                    </p>
                    <p class="font-bold-custom">
                        Edita tus datos de simulación
                    </p>
                    <div class="input-container">
                        <div class="label">
                            <p>
                                <span>Inversión inicial</span>
                            </p>
                            <p class="small-label">
                                Este depósito puede ser desde $1,000 pesos.
                            </p>
                        </div>
                        <div class="input">
                            <input class="MuiInputBase-input MuiInput-input" id="LPF_Cambiar_Inversion_Inicial" name="LPF_Cambiar_Inversion_Inicial" type="text" value>
                        </div>
                        <svg class="status status-ok" aria-hidden="true" data-icon="circle-check" data-prefix="fas" focusable="false" role="img" viewBox="0 0 512 512"><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM371.8 211.8C382.7 200.9 382.7 183.1 371.8 172.2C360.9 161.3 343.1 161.3 332.2 172.2L224 280.4L179.8 236.2C168.9 225.3 151.1 225.3 140.2 236.2C129.3 247.1 129.3 264.9 140.2 275.8L204.2 339.8C215.1 350.7 232.9 350.7 243.8 339.8L371.8 211.8z" fill="currentColor" /></svg><svg class="status status-not-ok" aria-hidden="true" data-icon="circle-xmark" data-prefix="fas" focusable="false" role="img" viewBox="0 0 512 512"><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z" fill="currentColor" /></svg>
                        <p>
                            <small class="status-msg">Mínimo: $1,000</small>
                        </p>
                    </div>
                    <div class="input-container">
                        <div class="label">
                            <p>
                                <span>Depósito mensual (opcional)</span>
                            </p>
                            <p class="small-label">
                                Este monto es opcional y se programará en la fecha que tú prefieras.
                            </p>
                        </div>
                        <div class="input">
                            <input class="MuiInputBase-input MuiInput-input" id="LPF_Cambiar_Inversion_Mensual" name="LPF_Cambiar_Inversion_Mensual" type="text" value>
                        </div>
                        <svg class="status status-ok" aria-hidden="true" data-icon="circle-check" data-prefix="fas" focusable="false" role="img" viewBox="0 0 512 512"><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM371.8 211.8C382.7 200.9 382.7 183.1 371.8 172.2C360.9 161.3 343.1 161.3 332.2 172.2L224 280.4L179.8 236.2C168.9 225.3 151.1 225.3 140.2 236.2C129.3 247.1 129.3 264.9 140.2 275.8L204.2 339.8C215.1 350.7 232.9 350.7 243.8 339.8L371.8 211.8z" fill="currentColor" /></svg><svg class="status status-not-ok" aria-hidden="true" data-icon="circle-xmark" data-prefix="fas" focusable="false" role="img" viewBox="0 0 512 512"><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z" fill="currentColor" /></svg>
                        <p>
                            <small class="status-msg">Valor debe ser igual a $0 o mayor a $500</small>
                        </p>
                    </div>
                    <div class="sc-kgUAyh gGRsPF d-none">
                        <div class="step-progress-bar">
                            <div class="RSPBprogressBar" style="--darkreader-inline-bgcolor:#4b5255;--darkreader-inline-bgimage:none;background-color:rgb(97, 98, 103);height:2px;width:175px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage>
                                <div class="RSPBstep" style="left:0%;transition-duration:300ms;">
                                    <button class="selectedStep accomplished" style="--darkreader-inline-bgcolor:#181a1b;--darkreader-inline-bgimage:none;--darkreader-inline-border-bottom:#6b6358;--darkreader-inline-border-left:#6b6358;--darkreader-inline-border-right:#6b6358;--darkreader-inline-border-top:#6b6358;background-color:white;border-radius:20px;border:1px solid rgb(97, 98, 103);height:20px;width:20px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage data-darkreader-inline-border-bottom data-darkreader-inline-border-left data-darkreader-inline-border-right data-darkreader-inline-border-top id="1"></button>
                                </div>
                                <div class="RSPBstep" style="left:33.3333%;transition-duration:300ms;">
                                    <button class="selectedStep accomplished" style="--darkreader-inline-bgcolor:#181a1b;--darkreader-inline-bgimage:none;--darkreader-inline-border-bottom:#6b6358;--darkreader-inline-border-left:#6b6358;--darkreader-inline-border-right:#6b6358;--darkreader-inline-border-top:#6b6358;background-color:white;border-radius:20px;border:1px solid rgb(97, 98, 103);height:20px;width:20px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage data-darkreader-inline-border-bottom data-darkreader-inline-border-left data-darkreader-inline-border-right data-darkreader-inline-border-top id="2"></button>
                                </div>
                                <div class="RSPBstep" style="left:66.6667%;transition-duration:300ms;">
                                    <button class="selectedStep accomplished" style="--darkreader-inline-bgcolor:#181a1b;--darkreader-inline-bgimage:none;--darkreader-inline-border-bottom:#6b6358;--darkreader-inline-border-left:#6b6358;--darkreader-inline-border-right:#6b6358;--darkreader-inline-border-top:#6b6358;background-color:white;border-radius:20px;border:1px solid rgb(97, 98, 103);height:20px;width:20px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage data-darkreader-inline-border-bottom data-darkreader-inline-border-left data-darkreader-inline-border-right data-darkreader-inline-border-top id="3"></button>
                                </div>
                                <div class="RSPBstep" style="left:100%;transition-duration:300ms;">
                                    <button class="selectedStep accomplished" style="--darkreader-inline-bgcolor:#181a1b;--darkreader-inline-bgimage:none;--darkreader-inline-border-bottom:#6b6358;--darkreader-inline-border-left:#6b6358;--darkreader-inline-border-right:#6b6358;--darkreader-inline-border-top:#6b6358;background-color:white;border-radius:20px;border:1px solid rgb(97, 98, 103);height:20px;width:20px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage data-darkreader-inline-border-bottom data-darkreader-inline-border-left data-darkreader-inline-border-right data-darkreader-inline-border-top id="4"></button>
                                </div>
                                <div class="RSPBprogression" style="--darkreader-inline-bgcolor:rgba(0, 0, 0, 0);--darkreader-inline-bgimage:linear-gradient(to right, #00bfba, #00bfba);background-color:rgb(0, 239, 232);height:2px;width:0px;" data-darkreader-inline-bgcolor data-darkreader-inline-bgimage>
                                    &nbsp;
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-container input-title">
                        <div class="label">
                            <p>
                                <span>Periodo de tiempo que vas a invertir</span>
                            </p>
                            <p class="small-label">
                                A mayor plazo la rentabilidad suele ser superior.
                            </p>
                        </div>
                    </div>
                    <div class="jss1">
                        <div class="sc-jOrMOR lbatDQ">
                            <div class="MuiInputBase-root MuiInput-root MuiInput-underline jss2">
                                <input class="MuiInputBase-input MuiInput-input" id="LPF_Cambiar_Duracion_plazo" max="50" min="0" step="1" type="number" value="0">
                            </div>
                            <p>
                                <select class="sc-jdAMXn bJqQyw" id="select" name="select" style="width: 100%;">
                                    <option value="anios">años</option>
                                    <option value="meses">meses</option>
                                </select>
                            </p>
                        </div>
                            <p>
                                <input hidden id="periodBar" max="50" min="1" type="range" value="1">
                            </p>
                    </div>
                    <p>
                        <input class="radio" hidden id="LPF_Cambiar_Si_Liquidez" name="liquidez" type="radio" value="SI">
                        <input class="radio" hidden id="LPF_Cambiar_No_Liquidez" name="liquidez" type="radio" value="NO">&nbsp;
                    </p>
                <div class="button-save-form mobile" id="saveButton">
                    <p>
                        Guardar
                    </p>
                </div>
            </div>
            <div class="form-email input-container desktop">
                <form class="form-area-email" action="index.html" id="formUserEmail" method="post">
                    <div class="label">
                        <p>
                            <span>¿A qué correo quieres que te enviemos tus resultados?</span><br>
                            Correo electrónico
                        </p>
                    </div>
                    <p>
                        <input id="userEmail" name="email" required type="email" value><button disabled="disabled" id="disabledBtn" type="submit">Enviar mis resultados</button>
                    </p>
                </form>
            </div>
        </div>
        <div class="col-md-8 d-flex wrap">
            <div class="col-md-12 simulacion">
                <div class="text-container perfil-container">
                    <p class="title-perfil font-bold-custom">
                        Perfil proyectado
                    </p>
                    <p>
                        Aquí está el resultado de tu simulación, según tu perfil <span class="font-bold-custom font-trans-upper" id="new-profile">MODERADO</span>
                    </p>
                </div>
            </div>
            <div class="col-md-12 proyeccion">
                <div class="container-amounts">
                    <div class="amount-container">
                        <p>
                            Monto estimado*
                        </p>
                        <p class="money font-bold-custom" id="amount_estimado">
                            $214,832.52 <span class="green-text">12,6%</span>
                        </p>
                        <div class="d-none centered" id="waiting_estimado">
                            <div class="loader_small">
                                &nbsp;
                            </div>
                        </div>
                    </div>
                    <div class="amount-container">
                        <p class="money font-bold-custom" id="amount_conservador">
                            $214,832.52
                        </p>
                        <div class="d-none centered" id="waiting_conservador">
                            <div class="loader_small">
                                &nbsp;
                            </div>
                        </div>
                        <p>
                            Escenario conservador
                        </p>
                    </div>
                    <div class="amount-container">
                        <p class="money font-bold-custom" id="amount_optimista">
                            $214,832.52
                        </p>
                        <div class="d-none centered" id="waiting_optimista">
                            <div class="loader_small">
                                &nbsp;
                            </div>
                        </div>
                        <p>
                            Escenario optimista
                        </p>
                    </div>
                </div>
                <div class="img-container torre">
                    <img src="https://www.principal.com.mx/sites/default/files/2022-10/stack.png" alt="Torre" width="231" height="224">
                    <div class="amount-container first">
                        <p id="towerRendimiento">
                            $55,945.78
                        </p>
                        <p>
                            <span class="font-bold-custom">Rendimiento</span>
                        </p>
                    </div>
                    <div class="amount-container second">
                        <p id="towerCapitalInvertido">
                            $200,000.00
                        </p>
                        <p>
                            <span class="font-bold-custom">Capital invertido</span>
                        </p>
                    </div>
                </div>
                <form action="https://principal.com.mx/inversion/FondosE2E?org=a670a3b4-6be5-4b5a-adcb-148fb06fcc31" id="forminvertir" method="post">
                    <p>
                        <input id="user" name="user" type="hidden" value="a670a3b4-6be5-4b5a-adcb-148fb06fcc31"> <input id="sourceonboarding" name="sourceonboarding" type="hidden" value="F"> <input id="tipoperfilamiento" name="tipoperfilamiento" type="hidden" value="A">
                    </p>
                    <div class="small-text">
                        <p>
                            <small>Podrás hacer los cambios que prefieras al momento de invertir.</small>
                        </p>
                    </div>
                    <p>
                        <button class="sc-ezWOiH kpaUaa" id="Simulador_Ya_quiero_invertir" type="submit">Empezar a invertir</button>
                    </p>
                </form>
            </div>
            <div class="col-md-6 inversion">
                <div class="text-container">
                    <h3>
                        ¿En qué se invertiría mi dinero?
                    </h3>
                    <p>
                        Te recomendamos invertir en el siguiente portafolio: <span class="font-bold-custom">GUBERNAMENTAL</span> (<span class="font-bold-custom" id="activostitulo2">PRINFGU</span>).
                    </p>
                </div>
                <div class="activos" style="display: none;">
                    <p id="activostitulo">
                        PRINLS3
                    </p>
                    <p class="d-flex">
                        Liquidez de la cartera <span class="ml-auto">15%</span>
                    </p>
                    <ul id="activoslistado">
                        <li>
                            Deuda nacional: <span>6.7%</span>
                        </li>
                        <li>
                            Deuda Extranjera: <span>3.4%</span>
                        </li>
                        <li>
                            RV Nacional: <span>21.3%</span>
                        </li>
                        <li>
                            RV Internacional: <span>46.6%</span>
                        </li>
                        <li>
                            RV Envergente: <span>19.3%</span>
                        </li>
                        <li>
                            Reportes: <span>2.7%</span>
                        </li>
                    </ul>
                </div>
                <div class="form-email input-container mobile">
                    <form class="form-area-email" action="index.html" method="post">
                        <div class="label">
                            <p>
                                <span>¿A qué correo quieres que te enviemos los resultados de tu simulación?</span>
                            </p>
                            <p>
                                Correo electrónico
                            </p>
                        </div>
                        <p>
                            <input name="email" required type="email" value><button type="submit">Enviar mis resultados</button>
                        </p>
                    </form>
                </div>
            </div>
            <div class="col-md-6 rueda">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>
</div>
<p>
    <button class="tipo-de-perfil d-none" style="--darkreader-inline-color:#a9a196;" color="#616267" data-darkreader-inline-color>Aplicar</button>
</p>
<div class="sc-kgUAyh gGRsPF d-none" id="resultado">
    <div class="jss45">
        <table class="jss47">
            <tbody>
                <tr>
                    <td colspan="2">
                        <div class="jss51">
                            <div class="jss46 jss49" id="estimado">
                                $34,343.13
                            </div>
                            <div class="jss46">
                                Monto estimado*
                            </div>
                        </div>
                    </td>
                </tr>
                <tr class="jss52">
                    <td colspan="1" width="50%">
                        <div class="jss51">
                            <div class="jss46" id="rendimiento">
                                $1,343.13
                            </div>
                            <div class="jss46 jss50">
                                Rendimiento
                            </div>
                        </div>
                    </td>
                    <td colspan="1" width="50%">
                        <div class="jss51">
                            <div class="jss46" id="capital">
                                $33,000.00
                            </div>
                            <div class="jss46 jss50">
                                Capital invertido
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="jss48">
            ¿Te gustó lo que viste?
        </div>
        <p>
            <button class="sc-ezWOiH lnillk">Da el siguiente paso</button>
        </p>
    </div>
    <p>
        <button class="sc-gXmSlM hrTPpB">Limpiar</button>
    </p>
</div>
</section>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
(() => {
  // ---------- Helpers ----------
  const $ = window.jQuery;
  const qs = (sel, root=document) => root.querySelector(sel);
  const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  const numberToMoney = (n) =>
    new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', maximumFractionDigits: 2 }).format(Number(n||0));

  const moneyToNumber = (str) => {
    if (typeof str !== 'string') return 0;
    // quita todo menos dígitos y punto
    const clean = str.replace(/[^\d.]/g, '');
    const n = Number(clean || 0);
    return Number.isFinite(n) ? n : 0;
  };

  const getParam = (k) => (new URLSearchParams(location.search)).get(k);

  const getOrCreateUUID = () => {
    try {
      const key = 'uuid_principal_user';
      let v = sessionStorage.getItem(key);
      if (!v) {
        v = (crypto && crypto.randomUUID) ? crypto.randomUUID() :
            'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
              const r = Math.random()*16|0, v = c === 'x' ? r : (r&0x3|0x8);
              return v.toString(16);
            });
        sessionStorage.setItem(key, v);
      }
      return v;
    } catch { return String(Date.now()) }
  };

  // ---------- DOM refs ----------
  const formCol = qs('#form-col');
  const amounts = qs('.container-amounts');
  const toggleBtn = qs('#toggleButton');
  const saveBtn = qs('#saveButton');

  toggleBtn?.addEventListener('click', () => {
    formCol.classList.toggle('activated');
    amounts.classList.toggle('activated');
  });
  saveBtn?.addEventListener('click', () => {
    formCol.classList.toggle('activated');
    amounts.classList.toggle('activated');
  });

  // ---------- Email forms (desktop + mobile) ----------
  qsa('.form-area-email').forEach((form) => {
    const emailInput = form.querySelector('input[type="email"]');
    const submitBtn = form.querySelector('button[type="submit"]');

    const validate = () => {
      // confía en la validación nativa del browser
      const ok = emailInput.checkValidity();
      if (submitBtn) submitBtn.disabled = !ok;
    };
    emailInput?.addEventListener('input', validate);
    validate();

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!emailInput.checkValidity()) { emailInput.reportValidity(); return; }

      // Construye payload seguro
      const perfil = qs('#risklevel')?.textContent?.trim() || '';
      const invInicial = moneyToNumber(qs('#LPF_Cambiar_Inversion_Inicial')?.value || '0');
      const invMensual = moneyToNumber(qs('#LPF_Cambiar_Inversion_Mensual')?.value || '0');
      const fondo = qs('#activostitulo')?.textContent?.trim() || '';
      const plazoVal = Number(qs('#LPF_Cambiar_Duracion_plazo')?.value || 0);
      const plazoTipo = qs('#select')?.value === 'anios' ? 'años' : 'meses';
      const esceConservador = qs('#amount_conservador')?.textContent?.trim() || '';
      const clave = getOrCreateUUID();

      const correoData = {
        NumContrato: "1",
        email: emailInput.value,
        perfil, invInicial: numberToMoney(invInicial),
        invMensual: numberToMoney(invMensual),
        plazo: `${plazoVal} ${plazoVal === 1 ? plazoTipo.slice(0, -1) : plazoTipo}`,
        fondo, clave, esceConservador,
      };

      const formattedData = {
        email: correoData.email,
        perfil: correoData.perfil,
        invInicial: correoData.invInicial,
        invMensual: correoData.invMensual,
        plazo: correoData.plazo,
        NumContrato: correoData.NumContrato,
        fondo: correoData.fondo,
        clave: correoData.clave,
        esceConservador: correoData.esceConservador,
        nameTemplateEcommerce: "ecommerce_invest",
        versionTemplateEcommerce: "1",
        hrefEcommerce: "https://principal.com.mx/inversion/FondosE2E?utm_source=Mailing&utm_medium=Salesforce&utm_campaign=ResultadosSimulador",
      };

      // NO enviar tokens desde el cliente. 
      try {
        // Ejemplo: tu API server-side maneja credenciales
        // replace /api/send-email with your real Drupal route
        await fetch('https://principal.com.mx/sendEmail', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                credentials: 'same-origin',
                body: JSON.stringify(correoData),
            });


        await fetch('https://principal.com.mx/sendOauth2Emails', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formattedData),
        });

        alert('El correo se envió correctamente.');
      } catch (err) {
        console.error(err);
        alert('Ocurrió un error al enviar el correo.');
      }
    });
  });

  // ---------- Inputs monetarios ----------
  const $ini = $('#LPF_Cambiar_Inversion_Inicial');
  const $men = $('#LPF_Cambiar_Inversion_Mensual');

  const normalizeMoney = ($el, min, allowZero=false) => {
    const raw = $el.val();
    const num = moneyToNumber(String(raw));
    const ok = allowZero ? (num === 0 || num >= min) : num >= min;

    const box = $el.closest('.input-container');
    box.find('.status-ok').css('display', ok ? 'block' : 'none');
    box.find('.status-not-ok').css('display', ok ? 'none' : 'block');
    box.find('.status-msg').css('display', ok ? 'none' : 'block');

    $el.val(numberToMoney(num));
    return num;
  };

  $ini.on('focus', function(){ this.value = moneyToNumber(this.value || '0') || ''; });
  $ini.on('input', function(){ this.value = this.value.replace(/[^\d]/g,''); });
  $ini.on('change', function(){ normalizeMoney($ini, 1000, false); mainprocess(); });

  $men.on('focus', function(){ this.value = moneyToNumber(this.value || '0') || ''; });
  $men.on('input', function(){ this.value = this.value.replace(/[^\d]/g,''); });
  $men.on('change', function(){ normalizeMoney($men, 500, true); mainprocess(); });

  // ---------- Período / liquidez ----------
  let liquidity = 'Si';
  $('#LPF_Cambiar_Si_Liquidez').on('click', () => { liquidity = 'Si'; mainprocess(); });
  $('#LPF_Cambiar_No_Liquidez').on('click', () => { liquidity = 'No'; mainprocess(); });

  $('#LPF_Cambiar_Duracion_plazo').on('change', function(){
    $('#periodBar').val(this.value);
    mainprocess();
  });
  $('#periodBar').on('change', function(){
    $('#LPF_Cambiar_Duracion_plazo').val(this.value);
    mainprocess();
  });
  $('#select').on('change', mainprocess);

  // ---------- Estado inicial desde URL ----------
  $(document).ready(() => {
    // Inicial
    const amount = Number(getParam('amount') || 0);
    $ini.val(numberToMoney(amount));
    normalizeMoney($ini, 1000);

    const extra = Number(getParam('extra') || 0);
    $men.val(numberToMoney(extra));
    normalizeMoney($men, 500, true);

    const noperiod = Number(getParam('noperiod') || 0);
    $('#LPF_Cambiar_Duracion_plazo').val(noperiod);

    const period = (getParam('period') || '').toLowerCase();
    $('#select').val(period === 'years' ? 'anios' : 'meses');

    const risk = getParam('risklevel') || $('#risklevel').text() || 'Moderado';
    $('#risklevel').text(risk);
    $('#new-profile').text(risk);

    const selected = getParam('selected');
    if (selected === 'option1') $('#LPF_Cambiar_Si_Liquidez').trigger('click');
    else $('#LPF_Cambiar_No_Liquidez').trigger('click');

    mainprocess();
  });

  // ---------- Chart ----------
  let chart;
  function renderChart(labels, values) {
    const ctx = document.getElementById('myChart');
    if (!ctx) return;

    if (chart) { chart.destroy(); chart = undefined; }

    // Opcional: registrar datalabels
    if (window.ChartDataLabels && !Chart.registry.plugins.get('datalabels')) {
      Chart.register(ChartDataLabels);
    }

    chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels,
        datasets: [{ data: values, borderWidth: 0 }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          datalabels: {
            formatter: (v) => v ? `${v}%` : '',
            anchor: 'end', align: 'end', clamp: true
          }
        },
        cutout: '55%'
      }
    });
  }

// ---------- Main process ----------
async function mainprocess() {
  // 1) Show loaders
  $('#amount_conservador,#amount_estimado,#amount_optimista').addClass('d-none');
  $('#waiting_conservador,#waiting_estimado,#waiting_optimista').removeClass('d-none');

  // 2) Read clean values
  const invIni  = moneyToNumber($('#LPF_Cambiar_Inversion_Inicial').val() || '0');
  const invMen  = moneyToNumber($('#LPF_Cambiar_Inversion_Mensual').val() || '0');
  const periodo = $('#select').val(); // 'anios' | 'meses'
  const dur     = Number($('#LPF_Cambiar_Duracion_plazo').val() || 0);
  const profile = $('#risklevel').text().trim();
  $('#new-profile').text(profile);

  // liquidity: get from checked radio button
  const checkedLiquidez = $('input[name="liquidez"]:checked').val();
  const liquidity = checkedLiquidez === 'SI' ? 'Si' : (checkedLiquidez === 'NO' ? 'No' : 'Si');

  const uuid = getOrCreateUUID();

  // 3) Update form action (UTMs)
  const base = new URL('https://principal.com.mx/inversion/FondosE2E');
  base.searchParams.set('org', uuid);
  ['utm_source','utm_medium','utm_campaign'].forEach(k => {
    const v = getParam(k);
    if (v) base.searchParams.set(k, v);
  });
  const invertirForm = document.querySelector('#forminvertir');
  if (invertirForm) invertirForm.action = base.pathname + base.search;

  $('#user').val(uuid);

  // 4) CSRF helper (Drupal)
  async function getDrupalCsrf() {
    const KEY = 'drupal_csrf_token';
    const cached = sessionStorage.getItem(KEY);
    if (cached) return cached;
    const r = await fetch('https://principal.com.mx/session/token', { credentials: 'same-origin' });
    if (!r.ok) throw new Error('No se pudo obtener CSRF token');
    const t = await r.text();
    sessionStorage.setItem(KEY, t);
    return t;
  }

  try {
    const csrf = await getDrupalCsrf();

    // 5) Call simulator
    const payload = {
      idSession: uuid,
      initialInvestment: invIni,
      monthlyContribution: invMen,
      inversionDuracionTipo: periodo, // 'anios' | 'meses'
      term: dur,
      liquidity,
      profile
    };

    const res = await fetch('https://principal.com.mx/getSimulatorResource', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'X-CSRF-Token': csrf
      },
      credentials: 'same-origin',
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const txt = await res.text().catch(() => '');
      console.error('Simulator error', res.status, txt);
      throw new Error(`Simulator error: ${res.status}`);
    }

    const msg   = await res.json();
    const responseApi = msg?.Message?.responseApi ?? {};
    const nivel = msg?.Message?.nivel_portafolio ?? {};

    // 6) Amounts
    $('#amount_conservador').html(numberToMoney(responseApi.scenarioConservative));
    const estPorc = responseApi.capitalInvested
      ? ((responseApi.yield / responseApi.capitalInvested) * 100).toFixed(2)
      : '0.00';
    $('#amount_estimado').html(`${numberToMoney(responseApi.estimatedamount)}<span class="green-text">${estPorc}%</span>`);
    $('#amount_optimista').html(numberToMoney(responseApi.scenarioOptimistic));
    $('#towerCapitalInvertido').text(numberToMoney(responseApi.capitalInvested));
    $('#towerRendimiento').text(numberToMoney(responseApi.yield));

    // 7) Portfolio labels/values (exclude metadata keys)
    const labels = [];
    const values = [];
    Object.entries(nivel).forEach(([key, raw]) => {
      if (key === 'portafolio_1' || key === 'portafolio_2' || key === 'perfil') return;
      const num = parseFloat(String(raw).replace(',', '.')); // handle "48,58"
      if (!isNaN(num) && num > 0) {
        labels.push(key.replace(/_/g, ' '));
        values.push(Number(num.toFixed(2)));
      }
    });

    // Titles
    let portafolio_1 = nivel.portafolio_1 || '';
    let portafolio_2 = nivel.portafolio_2 ? (' + ' + nivel.portafolio_2) : '';
    $("#activostitulo, #activostitulo2").text(portafolio_1 + portafolio_2);

    // 8) Build list with bars
    const $ul = $("ul#activoslistado");
    $ul.empty();
    for (let i = 0; i < labels.length; i++) {
      const v = values[i];
      if (v !== 0) {
        // Your original structure (li + bars as sibling divs)
        $ul.append('<li>' + labels[i] + ': <span>' + v.toFixed(2) + '%</span></li>');
        $ul.append('<div class="full-bar"></div>');
        $ul.append('<div class="parcial-bar" style="width:' + v + '%"></div>');

        // If you prefer valid HTML (bars inside each <li>), replace the three lines above with:
        // $ul.append(`
        //   <li>
        //     ${labels[i]}: <span>${v.toFixed(2)}%</span>
        //     <div class="bar-wrap">
        //       <div class="full-bar"></div>
        //       <div class="parcial-bar" style="width:${v}%"></div>
        //     </div>
        //   </li>
        // `);
      }
    }

    //.activos should be display:none removes
    $('.activos').css('display', 'block');

    // 9) Chart (optional, requires Chart.js + <canvas id="myChart">)
    const colors = ['#43729c', '#4e85b6', '#5795cc', '#95bee4', '#bad5ed', '#d3e4f4', '#bad5ed', '#d0dbf0'];
    const ctx = document.getElementById('myChart');
    if (ctx && window.Chart) {
      if (window.myPortfolioChart) window.myPortfolioChart.destroy();
      window.myPortfolioChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: colors.slice(0, labels.length),
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }

    // 10) Hide loaders, show amounts
    $('#waiting_conservador,#waiting_estimado,#waiting_optimista').addClass('d-none');
    $('#amount_conservador,#amount_estimado,#amount_optimista').removeClass('d-none');

  } catch (err) {
    console.error(err);
    // Fail-safe: hide loaders, show last values so UI isn't stuck
    $('#waiting_conservador,#waiting_estimado,#waiting_optimista').addClass('d-none');
    $('#amount_conservador,#amount_estimado,#amount_optimista').removeClass('d-none');
  }
}


})();
</script>
</body>
</html>